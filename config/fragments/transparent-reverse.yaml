listeners:
  - name: include-transparent
    mode: transparent
    listen: "${QPX_TRANSPARENT_LISTEN:-0.0.0.0:15005}"
    default_action: { type: block }
    rules:
      - name: allow-internal-app
        match:
          src_ip: ["127.0.0.1/32", "::1/128", "10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16"]
          host: ["internal-app.example.com"]
          dst_port: [80, 443]
        action: { type: direct }
reverse:
  - name: include-reverse
    listen: "${QPX_REVERSE_LISTEN:-0.0.0.0:19083}"
    routes:
      - match:
          host: ["internal-app.example.com"]
        upstreams:
          - "http://10.60.0.11:8080"
        lb: round_robin
        retry:
          attempts: 2
          backoff_ms: 100
        timeout_ms: 15000
