version: 1
state_dir: "${QPX_STATE_DIR:-~/.local/share/qpx}"
reverse:
  - name: reverse-tls-termination
    listen: "0.0.0.0:19443"
    tls:
      certificates:
        - sni: "shop.example.com"
          cert: "/etc/qpx/certs/shop.example.com.crt"
          key: "/etc/qpx/certs/shop.example.com.key"
        - sni: "cdn.example.com"
          cert: "/etc/qpx/certs/cdn.example.com.crt"
          key: "/etc/qpx/certs/cdn.example.com.key"
    routes:
      - match:
          host: ["shop.example.com"]
        upstreams:
          - "http://10.30.0.21:8080"
          - "http://10.30.0.22:8080"
        lb: round_robin
        retry:
          attempts: 2
          backoff_ms: 100
        timeout_ms: 20000
      - match:
          host: ["cdn.example.com"]
        upstreams:
          - "http://10.30.0.31:8080"
        lb: round_robin
        retry:
          attempts: 1
          backoff_ms: 50
        timeout_ms: 10000
