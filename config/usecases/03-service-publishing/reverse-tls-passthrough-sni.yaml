version: 1
state_dir: "${QPX_STATE_DIR:-~/.local/share/qpx}"
reverse:
  - name: reverse-tls-passthrough
    listen: "0.0.0.0:19444"
    tls:
      certificates:
        - sni: "fallback.example.com"
          cert: "/etc/qpx/certs/fallback.example.com.crt"
          key: "/etc/qpx/certs/fallback.example.com.key"
    tls_passthrough_routes:
      - match:
          sni: ["db.example.com"]
        upstreams:
          - "10.40.0.10:5432"
        lb: round_robin
        retry:
          attempts: 1
          backoff_ms: 10
        timeout_ms: 5000
    routes:
      - match:
          host: ["fallback.example.com"]
        upstreams:
          - "http://10.40.0.20:8080"
        lb: round_robin
        retry:
          attempts: 2
          backoff_ms: 100
        timeout_ms: 15000
