version: 1
state_dir: "${QPX_STATE_DIR:-~/.local/share/qpx}"

cache:
  backends:
    - name: redis-local-unix
      kind: redis
      endpoint: "redis+unix:///tmp/redis.sock?db=0"
      timeout_ms: 1200
      max_object_bytes: 1048576

listeners:
  - name: forward
    mode: forward
    listen: "127.0.0.1:8080"
    default_action: { type: block }
    cache:
      enabled: true
      backend: redis-local-unix
      namespace: "forward-local"
      default_ttl_secs: 30
      max_object_bytes: 1048576
    rules:
      - name: allow-loopback-cacheable
        match:
          src_ip: ["127.0.0.1/32", "::1/128"]
          method: ["GET", "HEAD"]
          host: ["*"]
        action: { type: direct }
