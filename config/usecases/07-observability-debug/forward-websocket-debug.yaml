version: 1
state_dir: "${QPX_STATE_DIR:-~/.local/share/qpx}"
listeners:
  - name: websocket-debug-forward
    mode: forward
    listen: "127.0.0.1:18086"
    default_action: { type: block }
    rules:
      - name: allow-websocket-upgrade
        match:
          src_ip: ["127.0.0.1/32", "::1/128"]
          host: ["ws.example.com"]
          headers:
            - name: upgrade
              regex: "(?i)websocket"
            - name: connection
              regex: "(?i).*upgrade.*"
        action: { type: direct }
      - name: allow-healthcheck
        match:
          src_ip: ["127.0.0.1/32", "::1/128"]
          host: ["ws.example.com"]
          path: ["/healthz"]
          method: ["GET"]
        action: { type: direct }
